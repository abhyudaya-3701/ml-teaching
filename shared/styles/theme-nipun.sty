% theme-nipun.sty - Clean, Simple Theme for Nipun's ML Teaching
% Focus on clean white background with Inter font

\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{theme-nipun}[2025/01/29 Nipun's Clean Simple Theme]

% Required packages
\RequirePackage{xcolor}
\RequirePackage{tcolorbox}
\tcbuselibrary{skins,breakable}

% ==============================================================================
% BASE THEME SETUP
% ==============================================================================

% % Check if we're using Beamer class
% \@ifclassloaded{beamer}{
%     % Use clean simple theme
%     \usetheme{default}
%     \usecolortheme{default}
    
%     % Set up Roboto font with XeLaTeX/LuaLaTeX
%     \RequirePackage{iftex}
%     \ifxetex
%         \RequirePackage{fontspec}
%         \IfFontExistsTF{Roboto}{
%             \setsansfont[BoldFont={Roboto Bold}]{Roboto}
%         }{
%             \IfFontExistsTF{Helvetica Neue}{
%                 \setsansfont{Helvetica Neue}
%             }{
%                 \setsansfont{Arial}
%             }
%         }
%         \IfFontExistsTF{Roboto Mono}{
%             \setmonofont{Roboto Mono}
%         }{
%             \IfFontExistsTF{Monaco}{
%                 \setmonofont{Monaco}
%             }{
%                 \setmonofont{Courier New}
%             }
%         }
%     \else
%         \ifluatex
%             \RequirePackage{fontspec}
%             \IfFontExistsTF{Roboto}{
%                 \setsansfont[BoldFont={Roboto Bold}]{Roboto}
%             }{
%                 \IfFontExistsTF{Helvetica Neue}{
%                     \setsansfont{Helvetica Neue}
%                 }{
%                     \setsansfont{Arial}
%                 }
%             }
%             \IfFontExistsTF{Roboto Mono}{
%                 \setmonofont{Roboto Mono}
%             }{
%                 \IfFontExistsTF{Monaco}{
%                     \setmonofont{Monaco}
%                 }{
%                     \setmonofont{Courier New}
%                 }
%             }
%         \fi
%     \fi
    
%     % Remove navigation symbols
%     \setbeamertemplate{navigation symbols}{}
%     \setbeamertemplate{frametitle}[default][left]
    
%     \def\isbeamer{true}
% }{
%     % For non-beamer documents, just use basic setup
%     \def\isbeamer{false}
% }

% \usepackage{iftex}
% \ifxetex
%     \usepackage{fontspec}
% \else\ifluatex
%     \usepackage{fontspec}
% \fi\fi

% \setmainfont{Roboto}
% \setmonofont{Roboto Mono}

\RequirePackage{iftex}
\iftutex % true for XeTeX or LuaTeX
  \RequirePackage{fontspec}
  % Use default fonts to avoid font loading errors
\else
  % pdfLaTeX path
  \RequirePackage[T1]{fontenc}
  \RequirePackage[utf8]{inputenc}
  \RequirePackage{lmodern}
\fi

%%% For Overleaf Envs %%%
% % Monospace: Roboto Mono variable font
% \setmonofont[
%     Path = {fonts/Roboto_Mono/},
%     UprightFont = {RobotoMono-VariableFont_wght.ttf},
%     Weight = 400,
%     BoldFeatures = {Weight=700}
% ]{RobotoMono}

% % Optional: If you want Roboto as serif replacement
% \setmainfont[
%     Path = fonts/Roboto/,
%     UprightFont = *-Regular.ttf,
%     BoldFont = *-Bold.ttf
% ]{Roboto}



% ==============================================================================
% COLOR PALETTE - Clean and Simple
% ==============================================================================

% Simple, clean color palette
\definecolor{nipun-blue}{RGB}{92, 138, 168}       % Muted blue for accents
\definecolor{nipun-lightblue}{RGB}{174, 203, 225} % Light blue for subtle accents
\definecolor{nipun-darkblue}{RGB}{55, 88, 115}    % Darker blue for emphasis
\definecolor{nipun-gray}{RGB}{70, 70, 70}         % Clean text gray
\definecolor{nipun-lightgray}{RGB}{248, 248, 248} % Very light gray
\definecolor{nipun-mediumgray}{RGB}{140, 140, 140} % Medium gray for subtle elements
\definecolor{nipun-green}{RGB}{76, 175, 80}       % Clean green
\definecolor{nipun-orange}{RGB}{255, 152, 0}      % Apple orange
\definecolor{nipun-red}{RGB}{255, 59, 48}         % Apple red
\definecolor{nipun-white}{RGB}{255, 255, 255}     % Pure white

% Apply Beamer-specific settings
\@ifclassloaded{beamer}{
    % Remove navigation symbols
    \setbeamertemplate{navigation symbols}{}
    
    % Clean white background
    \setbeamercolor{background canvas}{bg=nipun-white}
    \setbeamercolor{normal text}{fg=nipun-gray}

    % Title and headers
    \setbeamercolor{title}{fg=nipun-darkblue}
    \setbeamercolor{frametitle}{fg=nipun-darkblue, bg=}
    \setbeamercolor{subtitle}{fg=nipun-blue}
    \setbeamercolor{author}{fg=nipun-gray}
    \setbeamercolor{date}{fg=nipun-mediumgray}
    \setbeamercolor{institute}{fg=nipun-mediumgray}

    % Structure colors
    \setbeamercolor{structure}{fg=nipun-blue}
    \setbeamercolor{section in toc}{fg=nipun-gray}
    \setbeamercolor{subsection in toc}{fg=nipun-mediumgray}

    % Block colors
    \setbeamercolor{block title}{fg=nipun-white, bg=nipun-blue}
    \setbeamercolor{block body}{fg=nipun-gray, bg=nipun-lightgray}
    \setbeamercolor{block title alerted}{fg=nipun-white, bg=nipun-red}
    \setbeamercolor{block body alerted}{fg=nipun-gray, bg=nipun-lightgray}
    \setbeamercolor{block title example}{fg=nipun-white, bg=nipun-green}
    \setbeamercolor{block body example}{fg=nipun-gray, bg=nipun-lightgray}

    % Itemize colors
    \setbeamercolor{itemize item}{fg=nipun-blue}
    \setbeamercolor{itemize subitem}{fg=nipun-lightblue}
    \setbeamercolor{itemize subsubitem}{fg=nipun-mediumgray}
    \setbeamercolor{enumerate item}{fg=nipun-blue}
    \setbeamercolor{enumerate subitem}{fg=nipun-lightblue}
}{}

% ==============================================================================
% LOAD COMMON TCOLORBOX DEFINITIONS
% ==============================================================================

% Load the centralized common box definitions
\RequirePackage{common-boxes}

% ==============================================================================
% TYPOGRAPHY AND SPACING
% ==============================================================================

% Clean math spacing
\setlength{\abovedisplayskip}{0.8em}
\setlength{\belowdisplayskip}{0.8em}
\setlength{\abovedisplayshortskip}{0.4em}
\setlength{\belowdisplayshortskip}{0.4em}

% Beamer-specific spacing and styling
\@ifclassloaded{beamer}{
    % Clean list spacing
    \setbeamertemplate{itemize/enumerate body begin}{\vspace{0.5em}}
    \setbeamertemplate{itemize/enumerate body end}{\vspace{0.5em}}

    % Comfortable item spacing
    \setlength{\itemsep}{0.4em}
    \setlength{\parsep}{0.2em}
    \setlength{\topsep}{0.3em}

    % Clean frame title
    \setbeamertemplate{frametitle}[default][left,leftskip=0pt]
    \addtobeamertemplate{frametitle}{\vspace{0.3em}}{\vspace{0.6em}}
    
    % Comfortable margins
    \setbeamersize{text margin left=1.2cm, text margin right=1.2cm}
    
    % Simple bullet points with reduced indentation
    \setbeamertemplate{itemize item}{\raisebox{0.2ex}{\scalebox{0.6}{$\bullet$}}}
    \setbeamertemplate{itemize subitem}{\raisebox{0.15ex}{\scalebox{0.55}{$\circ$}}}
    \setbeamertemplate{itemize subsubitem}{\raisebox{0.1ex}{\scalebox{0.5}{$-$}}}
    
    % Reduce itemize indentation
    \setlength{\leftmargini}{1.2em}
    \setlength{\leftmarginii}{1.5em}
    \setlength{\leftmarginiii}{1.8em}
    
    % Clean enumeration
    \setbeamertemplate{enumerate item}{\insertenumlabel.}
    \setbeamertemplate{enumerate subitem}{\insertsubenumlabel)}
    
    % Block spacing
    \addtobeamertemplate{block begin}{\vspace{0.3em}}{}
    \addtobeamertemplate{block end}{}{\vspace{0.3em}}
}{}

% ==============================================================================
% CUSTOM COMMANDS FOR CONSISTENT FORMATTING
% ==============================================================================

% Global pop quiz counter
\newcounter{popquiz}
\setcounter{popquiz}{0}

% Beamer-specific commands
\@ifclassloaded{beamer}{
    % Pop quiz command
    % PopQuiz custom command with two arguments - this also forces the options to appear all at once on a slide
\newcommand{\popquiz}[2]{
    \stepcounter{popquiz}
    \begin{frame}{Pop Quiz \#\thepopquiz}
    \beamerdefaultoverlayspecification{}
        \begin{popquizbox}{\thepopquiz}
            #1
            
            \vspace{0.5em}
            \onslide<2->{\textbf{Answer:} #2}
        \end{popquizbox}
    \end{frame}
}

    % Section slide
    \newcommand{\sectionframe}[1]{
        \begin{frame}[plain,noframenumbering]
            \centering
            \vfill
            {\Huge\textbf{\textcolor{nipun-blue}{#1}}}
            \vfill
        \end{frame}
    }

    % Clean itemize
    \newcommand{\cleanitemize}[1]{
        \begin{itemize}[<+->]
            #1
        \end{itemize}
    }

    % Clean enumerate
    \newcommand{\cleanenumerate}[1]{
        \begin{enumerate}[<+->]
            #1
        \end{enumerate}
    }
}{}

% ==============================================================================
% BEAMER FOOTER AND OTHER STYLING
% ==============================================================================

\@ifclassloaded{beamer}{
    % Clean minimal footer with working slide numbers
    \setbeamertemplate{footline}{
        \leavevmode%
        \hbox{%
            \begin{beamercolorbox}[wd=\paperwidth,ht=2.25ex,dp=1ex,right]{page number in head/foot}%
                \usebeamerfont{page number in head/foot}\insertframenumber{}\,/\,\inserttotalframenumber\hspace*{1.8em}
            \end{beamercolorbox}
        }%
        \vskip0pt%
    }
    \setbeamercolor{page number in head/foot}{fg=nipun-mediumgray, bg=}
    \setbeamerfont{page number in head/foot}{size=\tiny, series=\mdseries}

    % Clean title page
    \setbeamertemplate{title page}{
        \vfill
        \begin{center}
            % Title
            {\Huge \textbf{\textcolor{nipun-darkblue}{\inserttitle}}}
            
            \vspace{0.8em}
            % Simple line
            {\textcolor{nipun-lightblue}{\rule{0.6\textwidth}{0.5pt}}}
            
            \vspace{1em}
            {\Large \textcolor{nipun-blue}{\insertsubtitle}}
            
            \vspace{2.5em}
            {\large \textcolor{nipun-gray}{\insertauthor}}
            
            \vspace{0.8em}
            {\textcolor{nipun-mediumgray}{\insertinstitute}}
            
            \vspace{1.2em}
            {\small \textcolor{nipun-mediumgray}{\insertdate}}
        \end{center}
        \vfill
    }

    % Clean table of contents - simple and elegant
    \setbeamertemplate{section in toc}[sections numbered]
    \setbeamertemplate{subsection in toc}[subsections numbered]

    % Caption styling
    \setbeamerfont{caption}{size=\small}
    \setbeamercolor{caption name}{fg=nipun-gray}
}{}


% Automatically insert a clean section title frame at each \section
\@ifclassloaded{beamer}{
  \AtBeginSection[]{
    \begin{frame}[plain,noframenumbering]
      \centering
      \vfill
      {\Huge\textbf{\textcolor{nipun-blue}{\insertsectionhead}}}
      \vfill
    \end{frame}
  }
}{}

% ==============================================================================
% FINAL SETUP
% ==============================================================================

% Ensure consistent fonts
\renewcommand{\familydefault}{\sfdefault}

\endinput